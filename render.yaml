services:
  # Private OpenClaw gateway (not publicly routable)
  - type: pserv
    name: openclaw-gateway
    env: node
    plan: starter
    buildCommand: npm install -g openclaw
    startCommand: openclaw gateway --port 18789 --bind custom
    envVars:
      - key: OPENCLAW_GATEWAY_PORT
        value: "18789"
      - key: OPENCLAW_GATEWAY_TOKEN
        sync: false

  # Public edge proxy with HTTP Basic Auth in front of the gateway
  - type: web
    name: openclaw-edge
    env: docker
    plan: starter
    dockerfilePath: ./deploy/edge/Dockerfile
    healthCheckPath: /
    envVars:
      # Format: user:$2y$... (bcrypt), e.g. output of: htpasswd -nbB youruser "your-password"
      - key: BASIC_AUTH_HTPASSWD_LINE
        sync: false
      - key: UPSTREAM_HOST
        value: openclaw-gateway
      - key: UPSTREAM_PORT
        value: "18789"
